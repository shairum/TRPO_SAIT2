<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–Ω–µ–≤–Ω–∏–∫ –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/stls.css' %}">
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="logo">
                <div class="logo-icon">‚úà</div>
                <span>–î–Ω–µ–≤–Ω–∏–∫ –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞</span>
            </div>

            <ul class="nav-links">
                <li><a href="{% url 'home' %}">üè† –ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="{% url 'travel_map' %}">üó∫ –ö–∞—Ä—Ç–∞</a></li>

                {% if user.is_authenticated %}
                    <div class="user-menu">
                        <li><a href="{% url 'add_trip' %}">‚úàÔ∏è –î–æ–±–∞–≤–∏—Ç—å –ø–æ–µ–∑–¥–∫—É</a></li>
                        <li>
                            <a href="{% url 'profile' %}">
                                {% if user.profile.avatar %}
                                    <img src="{{ user.profile.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä" class="avatar-img">
                                {% else %}
                                    <div class="user-avatar">
                                        {{ user.username|first|upper }}
                                    </div>
                                {% endif %}
                                üë§ {{ user.username }}
                            </a>
                        </li>
                        <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
                        <li>
                            <button class="theme-toggle" id="themeToggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                                üåô
                            </button>
                        </li>
                        <li>
                            <form method="post" action="{% url 'logout' %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" style="background: none; border: none; color: white; cursor: pointer; padding: 12px 20px; border-radius: 8px; transition: all 0.3s ease; font-weight: 500; display: flex; align-items: center; gap: 8px; font-family: inherit; font-size: inherit;">
                                    üö™ –í—ã–π—Ç–∏
                                </button>
                            </form>
                        </li>
                    </div>
                {% else %}
                    <div class="user-menu">
                        <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
                        <li>
                            <button class="theme-toggle" id="themeToggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                                üåô
                            </button>
                        </li>
                        <li>
                            <a href="#" onclick="showLoginOptions()" style="display: flex; align-items: center; gap: 8px;">
                                üîë –í–æ–π—Ç–∏
                            </a>
                        </li>
                        <li><a href="{% url 'register' %}" class="btn-outline">üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a></li>
                    </div>

                    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Å–ø–æ—Å–æ–±–∞ –≤—Ö–æ–¥–∞ -->
                    <div id="loginModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
                        <div style="background: var(--bg-secondary); padding: 2rem; border-radius: 16px; max-width: 400px; width: 90%; box-shadow: var(--card-shadow);">
                            <h2 style="color: var(--accent-primary); margin-bottom: 1.5rem; text-align: center; font-size: 1.5rem;">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –≤—Ö–æ–¥–∞</h2>

                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                                <!-- –ö–Ω–æ–ø–∫–∞ –ª–æ–≥–∏–Ω–∞ -->
                                <a href="{% url 'login' %}"
                                   style="display: flex; align-items: center; justify-content: center; gap: 8px; padding: 14px 28px; background: linear-gradient(135deg, var(--accent-primary) 0%, #152F5D 100%); color: white; text-decoration: none; border-radius: 12px; border: none; cursor: pointer; transition: all 0.3s ease; font-weight: 600; font-size: 1rem; box-shadow: 0 4px 15px rgba(30, 67, 136, 0.3);">
                                    üë§ –õ–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å
                                </a>

                                <!-- –ö–Ω–æ–ø–∫–∞ –Ø–Ω–¥–µ–∫—Å -->
                                <a href="{% url 'social:begin' 'yandex-oauth2' %}"
                                   style="display: flex; align-items: center; justify-content: center; gap: 8px; padding: 14px 28px; background: linear-gradient(135deg, var(--accent-primary) 0%, #152F5D 100%); color: white; text-decoration: none; border-radius: 12px; border: none; cursor: pointer; transition: all 0.3s ease; font-weight: 600; font-size: 1rem; box-shadow: 0 4px 15px rgba(30, 67, 136, 0.3);">
                                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDIyQzE3LjUyMjggMjIgMjIgMTcuNTIyOCAyMiAxMkMyMiA2LjQ3NzE1IDE3LjUyMjggMiAxMiAyQzYuNDc3MTUgMiAyIDYuNDc3MTUgMiAxMkMyIDE3LjUyMjggNi40NzcxNSAyMiAxMiAyMloiIGZpbGw9IiNmZmNjMDAiLz4KPHBhdGggZD0iTTEyLjU1MjUgMTUuNDk1N0g5LjY0N1Y4LjUwNDM0SDEyLjU3ODVDMTMuODQ3MyA4LjUwNDM0IDE0LjcyNTIgOC44ODQ1NiAxNS4yMTIyIDkuNjQ1MDJDMTUuNjk5MiAxMC40MDU0OCAxNS45NDI3IDExLjQ3MTcgMTUuOTQyNyAxMi43NDM4QzE1Ljk0MjcgMTMuOTc4MyAxNS43MTM2IDE1LjAwODggMTUuMjU1NCAxNS44MzUzQzE0Ljc5NzIgMTYuNjYxOCAxMy45NDQ3IDE3LjA3NSAxMi43OTc5IDE3LjA3NUMxMi4wNDY5IDE3LjA3NSAxMS40Mjg3IDE2LjkxNDUgMTAuOTQzNCAxNi41OTM1QzEwLjQ1ODEgMTYuMjcyNSAxMC4wOTU3IDE1Ljg0NzcgOS44NTYyIDE1LjMxOTJMMTAuOTU5NyAxNC40NDc2QzExLjE0MjEgMTQuODMzOCAxMS40Mzc1IDE1LjEyNDUgMTEuODQ1NyAxNS4zMTk4QzEyLjI1MzkgMTUuNTE1MSAxMi43MTA5IDE1LjYxMjggMTMuMjE2OCAxNS42MTI4QzEzLjk1MzEgMTUuNjEyOCAxNC41MDQ5IDE1LjM3NzcgMTQuODY3MiAxNC45MDc1QzE1LjIyOTUgMTQuNDM3MyAxNS40MTA2IDEzLjc2NjEgMTUuNDEwNiAxMi44OTM4QzE1LjQxMDYgMTIuMDQxNyAxNS4yNDUxIDExLjQxMzUgMTQuOTE0MSAxMS4wMDk0QzE0LjU4MzEgMTAuNjA1MyAxNC4wNzE5IDEwLjQwMzMgMTMuMzgwNCAxMC40MDMzSDEwLjc0NzRWMTEuOTYwMkgxMi41NTI1VjEyLjk5ODdIMTAuNzQ3NFYxNC40NDc2SDEyLjU1MjVWMTUuNDk1N1oiIGZpbGw9IiMwMDAwMDAiLz4KPC9zdmc+"
                                         alt="Yandex"
                                         style="width: 20px; height: 20px; filter: brightness(0) invert(1);">
                                    –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å
                                </a>

                                <!-- –ö–Ω–æ–ø–∫–∞ Telegram -->
                                <a href="{% url 'telegram_auth' %}"
                                   style="display: flex; align-items: center; justify-content: center; gap: 8px; padding: 14px 28px; background: linear-gradient(135deg, var(--accent-primary) 0%, #152F5D 100%); color: white; text-decoration: none; border-radius: 12px; border: none; cursor: pointer; transition: all 0.3s ease; font-weight: 600; font-size: 1rem; box-shadow: 0 4px 15px rgba(30, 67, 136, 0.3);">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="filter: brightness(0) invert(1);">
                                        <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.562 8.158c-.174-.761-1.003-1.141-1.752-.768l-10.5 5.25c-.535.268-.793.848-.623 1.396.17.548.696.911 1.268.911.115 0 .232-.019.345-.059l2.413-.804v3.851c0 .827.673 1.5 1.5 1.5s1.5-.673 1.5-1.5v-3.851l5.918 2.472c.749.373 1.578-.007 1.752-.768.174-.761-.207-1.578-.956-1.951l-5.25-2.625 5.25-2.625c.749-.373 1.13-1.19.956-1.951z"/>
                                    </svg>
                                    –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram
                                </a>
                            </div>

                            <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã -->
                            <button onclick="hideLoginOptions()"
                                    style="display: flex; align-items: center; justify-content: center; gap: 8px; padding: 14px 28px; background: linear-gradient(135deg, var(--accent-primary) 0%, #152F5D 100%); color: white; text-decoration: none; border-radius: 12px; border: none; cursor: pointer; transition: all 0.3s ease; font-weight: 600; font-size: 1rem; box-shadow: 0 4px 15px rgba(30, 67, 136, 0.3); width: 100%; margin-top: 1rem;">
                                ‚úñ –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </div>

                    <script>
                        function showLoginOptions() {
                            document.getElementById('loginModal').style.display = 'flex';
                        }

                        function hideLoginOptions() {
                            document.getElementById('loginModal').style.display = 'none';
                        }

                        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
                        document.getElementById('loginModal').addEventListener('click', function(e) {
                            if (e.target === this) {
                                hideLoginOptions();
                            }
                        });

                        // –î–æ–±–∞–≤–ª—è–µ–º hover —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
                        document.addEventListener('DOMContentLoaded', function() {
                            const modalButtons = document.querySelectorAll('#loginModal a, #loginModal button');
                            modalButtons.forEach(button => {
                                button.addEventListener('mouseenter', function() {
                                    this.style.transform = 'translateY(-2px)';
                                    this.style.boxShadow = '0 6px 20px rgba(30, 67, 136, 0.4)';
                                });

                                button.addEventListener('mouseleave', function() {
                                    this.style.transform = 'translateY(0)';
                                    this.style.boxShadow = '0 4px 15px rgba(30, 67, 136, 0.3)';
                                });
                            });
                        });
                    </script>
                {% endif %}
            </ul>
        </nav>
    </header>

    <main class="container">
        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        {% if messages %}
        <div class="messages">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        {% block content %}
        {% endblock %}
    </main>

    <script>
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–æ–π
        const themeToggle = document.getElementById('themeToggle');
        const currentTheme = localStorage.getItem('theme') || 'light';

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é —Ç–µ–º—É
        document.documentElement.setAttribute('data-theme', currentTheme);
        updateThemeIcon(currentTheme);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
        themeToggle.addEventListener('click', function() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';

            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        });

        function updateThemeIcon(theme) {
            const icon = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
            themeToggle.innerHTML = icon;
            themeToggle.setAttribute('title', theme === 'light' ? '–í–∫–ª—é—á–∏—Ç—å —Ç–µ–º–Ω—É—é —Ç–µ–º—É' : '–í–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É');
        }
    </script>
</body>
</html>