{% extends 'diary/base.html' %}

{% block content %}
<div class="card" style="max-width: 400px; margin: 0 auto; text-align: center;">
    <h1 class="page-title">–í—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram</h1>
    
    <div style="margin-bottom: 2rem;">
        <div style="font-size: 4rem; margin-bottom: 1rem;">üì±</div>
        <p style="color: #666; margin-bottom: 2rem;">
            –î–ª—è –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Telegram:
        </p>
        <ol style="text-align: left; color: #666; margin-bottom: 2rem;">
            <li>–û—Ç–∫—Ä–æ–π—Ç–µ Telegram</li>
            <li>–ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞: <strong><a href="https://t.me/{{ bot_username }}" target="_blank">@{{ bot_username }}</a></strong></li>
            <li>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É <code>/start</code></li>
            <li>–ü–æ–ª—É—á–∏—Ç–µ –∫–æ–¥ –¥–ª—è –≤—Ö–æ–¥–∞</li>
        </ol>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–ª—è –≤–≤–æ–¥–∞ –∫–æ–¥–∞ -->
    <form id="telegramCodeForm" style="margin-bottom: 2rem;">
        {% csrf_token %}
        <div class="form-group">
            <label class="form-label">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ Telegram</label>
            <input type="text" name="telegram_code" class="form-control"
                   placeholder="123456" required maxlength="6"
                   style="text-align: center; font-size: 1.2rem; letter-spacing: 2px;">
        </div>
        <button type="submit" class="btn" style="width: 100%;">
            üîê –í–æ–π—Ç–∏ —Å –∫–æ–¥–æ–º
        </button>
    </form>

    <div style="margin-top: 2rem;">
        <a href="{% url 'login' %}" class="btn btn-secondary">
            ‚Üê –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É –≤—Ö–æ–¥–∞
        </a>
    </div>
</div>

<script>
document.getElementById('telegramCodeForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const formData = new FormData(this);
    const code = formData.get('telegram_code');

    fetch('/telegram-code-login/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({
            telegram_code: code
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            window.location.href = data.redirect_url;
        } else {
            alert('–û—à–∏–±–∫–∞: ' + data.message);
        }
    })
    .catch(error => {
        alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error);
    });
});
</script>
{% endblock %}