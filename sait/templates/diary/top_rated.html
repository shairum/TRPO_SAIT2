{% extends 'diary/base.html' %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
        <h1 class="page-title" style="margin: 0;">{{ title }}</h1>
        
        <div style="display: flex; gap: 1rem;">
            <a href="{% url 'home' %}" class="btn btn-secondary">
                ‚Üê –í—Å–µ –ø–æ–µ–∑–¥–∫–∏
            </a>
        </div>
    </div>

    {% if trips %}
        <div class="trip-grid">
            {% for trip in trips %}
                <div class="trip-card">
                    <!-- –ú–µ—Å—Ç–æ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ -->
                    <div style="position: absolute; top: 1rem; right: 1rem; background: var(--accent-secondary); color: var(--accent-primary); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.9rem;">
                        {{ forloop.counter }}
                    </div>

                    <h2 class="trip-title">
                        <a href="{{ trip.get_absolute_url }}">
                            {{ trip.title }}
                        </a>
                    </h2>

                    <div class="trip-meta">
                        <div class="trip-meta-item">
                            üìç {{ trip.country }}
                        </div>
                        <div class="trip-meta-item">
                            üë§ {{ trip.user.username }}
                        </div>
                    </div>

                    <!-- –†–µ–π—Ç–∏–Ω–≥ -->
                    <div style="margin-bottom: 1rem;">
                        <div class="rating-badge {{ trip.get_rating_class }}" style="font-size: 1.1rem;">
                            <span style="display: flex; align-items: center; gap: 0.5rem;">
                                ‚≠ê
                                {% if trip.avg_rating %}
                                    {{ trip.avg_rating|floatformat:1 }}
                                {% else %}
                                    {{ trip.average_rating|floatformat:1 }}
                                {% endif %}
                                <span style="font-size: 0.9rem; opacity: 0.8;">
                                    (
                                    {% if trip.reviews_count_annotated %}
                                        {{ trip.reviews_count_annotated }}
                                    {% else %}
                                        {{ trip.reviews_count }}
                                    {% endif %}
                                    –æ—Ç–∑—ã–≤{{ trip.reviews_count|pluralize:"–æ–≤" }})
                                </span>
                            </span>
                        </div>
                    </div>

                    <p>{{ trip.description|truncatewords:20 }}</p>

                    <a href="{{ trip.get_absolute_url }}" class="btn">
                        –ß–∏—Ç–∞—Ç—å —Ä–∞—Å—Å–∫–∞–∑ ‚Üí
                    </a>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">
                {% if title == 'üèÜ –õ—É—á—à–∏–µ –ø–æ–µ–∑–¥–∫–∏ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É' %}
                    ‚≠ê
                {% else %}
                    üí¨
                {% endif %}
            </div>
            <h2>–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞</h2>
            <p style="color: var(--text-secondary); margin-top: 1rem;">
                {% if title == 'üèÜ –õ—É—á—à–∏–µ –ø–æ–µ–∑–¥–∫–∏ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É' %}
                    –ï—â–µ –Ω–∏–∫—Ç–æ –Ω–µ –æ—Å—Ç–∞–≤–∏–ª –æ—Ü–µ–Ω–æ–∫ –ø–æ–µ–∑–¥–∫–∞–º.
                {% else %}
                    –ï—â–µ –Ω–∏–∫—Ç–æ –Ω–µ –æ—Å—Ç–∞–≤–∏–ª –æ—Ç–∑—ã–≤–æ–≤ –æ –ø–æ–µ–∑–¥–∫–∞—Ö.
                {% endif %}
            </p>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap; justify-content: center;">
                <a href="{% url 'home' %}" class="btn">
                    üìù –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –ø–æ–µ–∑–¥–∫–∏
                </a>
                {% if user.is_authenticated %}
                    <a href="{% url 'add_trip' %}" class="btn btn-secondary">
                        ‚úàÔ∏è –î–æ–±–∞–≤–∏—Ç—å –ø–æ–µ–∑–¥–∫—É
                    </a>
                {% endif %}
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}